---
title: "Домашняя работа"
output:
  pdf_document: default
  html_document:
    df_print: paged
header-includes:
- \usepackage[russian]{babel}
- \usepackage{hyperref}
- \hypersetup{ colorlinks = true, urlcolor = blue}
---

```{r}
library(tidyverse)
```


### Задание 1

1. Загрузите файл `housing.csv` с данными по ценам на квартиры в пригородах Бостона (одна строка – один пригород) и сохраните его в датафрейм. Описание показателей:

* `RM` – среднее число комнат;
 	
* `LSTAT` – процент жителей низкого материального статуса:
 	
* `MEDV` – медианное значение цены на дом в тысячах долларов.

     Посмотрите на датафрейм – откройте его в отдельном окне RStudio.
     
```{r}
housing.prices <- read.csv('housing.csv', sep = '\t')
housing.prices %>% View
```
     

2. Выведите на экран первые и последние строки в датафрейме. Выведите информацию о типах столбцов в таблице («структуру» датафрейма). Проверьте, что все столбцы с числовыми данными считались как числовые, а не текстовые.

```{r}
head(housing.prices)
tail(housing.prices)
str(housing.prices)
```

3. Выведите на экран сводные характеристики всех столбцов в датафрейме – описательные статистики. Наблюдаются ли серьезные отличия в медианных и средних значениях показателей (один из признаков наличия аномальных наблюдений или выбросов)? Насколько велик разброс значений цен на квартиры, если мы сравним минимальное значение и максимальное? Есть ли в каком-нибудь показателе с содержательной точки зрения нетипичные значения (отрицательные цены и прочее)?

```{r}
summary(housing.prices)
# серьезные отличия мадианы и среднего есть у параметров: TRACT (хвост слева), CRIM (хвост справа), ZN (хвост справа), TAX (хвост справа)
# разброс цен на квартиры большой (размах 45 тыс $)
# с содержательной точки зрения нетипичных значений в нашем датасете нет
```

4. Используя стандартные средства R (без `tidyverse`), добавьте в датафрейм столбец `MEDV_N`, который содержит медианные цены на квартиры из столбца `MEDV`, измеренные в долларах (не в тысячах долларов).

```{r}
housing.prices$MEDV_N <- housing.prices$MEDV * 1000
head(housing.prices)
```


5. Используя стандартные средства R (без `tidyverse`), сохраните в датафрейм `small` только те строки, которые соответствуют пригородам, где медианная цена за квартиру (`MEDV`) больше 400 тысяч, но меньше 500 тысяч. Сколько таких пригородов?

    *Подсказка:* для определения числа строк в датафрейме можно воспользоваться функцией `nrow()`.
    
```{r}
small <- housing.prices[housing.prices$MEDV > 400 & housing.prices$MEDV < 500, ]
nrow(small)
# таких пригородов 0, так как у нас максимальная медианая цена 50 тыс. 
```
    

6. Используя средства библиотеки `tidyverse` (`dplyr`), создайте столбец `MEDV_LOG`, который содержит натуральные логарифмы значений медианных цен на квартиры из столбца `MEDV`.

```{r}
housing.prices <- housing.prices %>% mutate(LG_MEDV = log(MEDV))
housing.prices %>% head
```


7. Используя средства библиотеки `tidyverse` (`dplyr`), выведите на экран в отдельной вкладке строки, которые соответствуют пригородам, где процент населения, низкого по материальному статусу, составляет не менее 30%.

```{r}
housing.prices %>% filter(LSTAT >= 30) %>% View
```


8. Используя стандартные средства R (без `ggplot2`), постройте гистограмму для показателя `LSTAT`. Добавьте заголовок и подписи к осям, измените цвет. Что можно сказать о распределении процента населения с низким материальным статусом? Какие значения преобладают, есть ли скошенность в сторону слишком больших или слишком маленьких значений? Сохраните полученный график в файл `hist.png`, используя код R (не кнопку *Export* в окне с графиком).

```{r}
png('hist.png')
dev.copy(png, 'hist.png')

hist(housing.prices$LSTAT, 
     main = 'Распределение процента населения\nс низким материальным статусом',
     xlab = 'Процент населения',
     ylab = 'Кол-во записей',
     col = 'lightblue',
     border = n) 

dev.off()

# по распределнию мы можем сделать вывод, что б`ольшее кол-во округов имеют процент "бедных" от 5 до 15
# распределение имеет хвост справа, это говорит о том, что у нас есть небольшое кол-во максимальных значений
# в целом распределение близко к нормальному (медиана и среднее близки 11.36 и 12.65 соответственно)
# также мы можем сделать вывод, у нас есть до 50 районов, в которых процент "бедных" от 20 до 40 %
```


9. Выполните предыдущий пункт, но уже используя средства библиотеки `tidyverse` (графика с `ggplot2`).

```{r}
ggplot(data = housing.prices, aes(x = LSTAT)) +
  geom_histogram(binwidth = 3, fill = 'lightblue', alpha=.75, color = 'skyblue', size = .5)  +
  theme_classic() +
  labs(title = 'Распределение процента населения\nс низким материальным статусом',
       x = 'Процент населения',
       y = 'Кол-во записей')

```


### Задание 2

1. Загрузите данные из файла `flats.csv` и сохраните в датафрейм. Посмотрите на датафрейм.

```{r}
df.flats <- read.csv(file.choose())
View(df.flats)
str(df.flats)
```


2. Сгруппируйте данные по показателю `brick` (дом из кирпича или нет). Определите, сколько домов каждого типа присутствует в данных. Каких домов больше?

```{r}
df.flats %>% group_by(brick) %>% tally
# больше домов не из кирпича (1381, против 659)
```


3. Сгруппируйте данные по показателю `brick` (дом из кирпича или нет). Определите среднюю цену на квартиры (`price`) по каждой группе. Квартиры в каких домах, в среднем, дороже?

```{r}
df.flats %>% group_by(brick) %>% summarise(avg_price = mean(price))
# квартиры в домах из керпича в среднем стоят дороже
```


4. С помощью библиотеки `ggplot2` постройте гистограммы для цен на квартиры с разбиением на группы по показателю `walk` (находится ли дом в шаговой доступности от метро или нет). По группам – отдельное окно-фасетка для каждой группы в рамках одного графика.
Распределение цен в какой группе менее скошенное (вправо или влево)?

```{r}
df.flats <- df.flats %>% mutate(is_walk = if_else(walk == 1, 'is walk', 'not wolk'))

ggplot(data = df.flats, aes(x = price, colour = is_walk, fill= is_walk)) +
  geom_histogram(alpha = .5, show.legend = FALSE) +
  labs(title = 'Распределение цен в зависимости от шаговой доступности метро',
       x = 'Цена в тыс $',
       y = 'Кол-во записей') +
  facet_grid(is_walk~.) +
  theme_bw() 

# распределения в обоих группах имеет хвост справа, разброс значений очень большой от 0 до 800 тыс $
# большинство квартир в обоих группах отцениваются от 0 до 200 тыс $
  
```


5. С помощью библиотеки `ggplot2` постройте диаграммы рассеяния для показателей `totsp` (общая площадь квартиры в квадратных метрах) и `price` (цена квартиры), сделав цвет точек зависимым от показателя `walk`, а размер – от показателя `kitsp` (площадь кухни).

    *Подсказка:* с размером точек можно поступать точно так же, как с цветом, либо указывать внутри `geom_point()`, либо внутри `aes()` в зависисимости от постановки задачи. Аргумент для настройки размера точки – `size`.
    
    
```{r}
ggplot(data = df.flats, aes(x = price, y = totsp, col = is_walk, size = kitsp)) +
  geom_point(alpha = .5) +
  theme_bw() +
  labs(title = 'Зависимость площади квартиры от цены',
						x = 'Цена квартиры в тыс $',
						y = 'Площадь квартиры')

# мы можем сделать вывод, что у нас есть сильная прямая зависисмость цены квартиры от площади, чем больше площадь квартиры, тем больше цена
```



    

